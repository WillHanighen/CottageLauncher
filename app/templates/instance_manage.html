{% extends "base.html" %}
{% block content %}
<div class="flex items-center justify-between">
  <div>
    <a href="/installed" class="text-slate-300 hover:text-white text-sm">← Back to Installed</a>
    <h1 class="text-2xl font-semibold mt-1">Manage: {{ meta.instance_name or slug }}</h1>
    <div class="text-xs text-slate-400">{{ slug }}</div>
  </div>
  <div class="flex gap-2">
    <form hx-post="/api/instances/{{ slug }}/launch" hx-target="#launch-progress" hx-swap="innerHTML">
      <button type="submit" class="px-3 py-1.5 rounded bg-emerald-600 hover:bg-emerald-500 text-white text-sm">Launch</button>
    </form>
    <button class="text-sm px-3 py-1.5 rounded border border-slate-700 hover:bg-slate-800" hx-get="/api/instances/{{ slug }}/updates/check" hx-target="#update-area" hx-swap="innerHTML">Check Updates</button>
  </div>
</div>
<div id="launch-progress" class="mt-2 text-xs text-slate-400"></div>

<div class="mt-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
  <!-- Mods Panel -->
  <section class="lg:col-span-2 border border-slate-800 rounded-lg bg-slate-900/40">
    <div class="px-4 py-3 border-b border-slate-800 flex items-center justify-between">
      <h2 class="text-lg font-semibold">Mods</h2>
      <div class="flex items-center gap-2">
        <a href="/instances/{{ slug }}/catalog" class="text-xs px-3 py-1.5 rounded border border-slate-700 hover:bg-slate-800">Browse catalog</a>
      </div>
    </div>
    <div class="p-4 space-y-4">
      <!-- Upload -->
      <form hx-post="/api/instances/{{ slug }}/mods/upload" hx-encoding="multipart/form-data" hx-target="#mods-list" hx-swap="outerHTML" class="flex items-center gap-2">
        <input type="file" name="file" accept=".jar" class="text-sm file:mr-3 file:px-3 file:py-1.5 file:rounded file:border-0 file:bg-slate-800 file:text-slate-200 hover:file:bg-slate-700" />
        <button type="submit" class="text-sm px-3 py-1.5 rounded border border-slate-700 hover:bg-slate-800">Upload .jar</button>
      </form>

      <!-- Filter installed mods -->
      <div>
        <div class="text-sm text-slate-300 mb-2">Filter installed mods</div>
        <input class="w-full px-3 py-2 rounded bg-slate-900 border border-slate-800 text-sm focus:outline-none focus:ring-1 focus:ring-emerald-600" type="text" name="q" placeholder="Type to filter installed mods…" hx-get="/api/instances/{{ slug }}/mods/list" hx-target="#mods-list" hx-trigger="keyup changed delay:300ms" />
      </div>

      <!-- Mods list -->
      <div id="mods-list" class="mt-2"
           hx-get="/api/instances/{{ slug }}/mods/list" hx-trigger="load" hx-swap="outerHTML">
        <div class="text-slate-400 text-sm">Loading mods…</div>
      </div>
    </div>
  </section>

  <!-- Updates Panel -->
  <aside class="border border-slate-800 rounded-lg bg-slate-900/40">
    <div class="px-4 py-3 border-b border-slate-800">
      <h2 class="text-lg font-semibold">Updates</h2>
    </div>
    <div class="p-4 space-y-3">
      <div id="update-area" class="text-sm text-slate-400">Click "Check Updates" to see if a newer modpack version is available.</div>
      {% if meta.version_number %}
      <div class="text-xs text-slate-500">Current version: <span class="font-mono">{{ meta.version_number }}</span></div>
      {% endif %}
      {% if meta.created_at %}
      <div class="text-xs text-slate-500">Installed: {{ meta.created_at }}</div>
      {% endif %}
    </div>
  </aside>
</div>

<!-- Resource Packs & Shader Packs Row -->
<div class="mt-6 grid grid-cols-1 lg:grid-cols-2 gap-6">
  <!-- Resource Packs -->
  <section class="border border-slate-800 rounded-lg bg-slate-900/40">
    <div class="px-4 py-3 border-b border-slate-800 flex items-center justify-between">
      <h2 class="text-lg font-semibold">Resource Packs</h2>
      <a href="/instances/{{ slug }}/catalog" class="text-xs px-3 py-1.5 rounded border border-slate-700 hover:bg-slate-800">Browse catalog</a>
    </div>
    <div class="p-4 space-y-4">
      <form hx-post="/api/instances/{{ slug }}/resourcepacks/upload" hx-encoding="multipart/form-data" hx-target="#resourcepacks-list" hx-swap="outerHTML" class="flex items-center gap-2">
        <input type="file" name="file" accept=".zip,.jar" class="text-sm file:mr-3 file:px-3 file:py-1.5 file:rounded file:border-0 file:bg-slate-800 file:text-slate-200 hover:file:bg-slate-700" />
        <button type="submit" class="text-sm px-3 py-1.5 rounded border border-slate-700 hover:bg-slate-800">Upload</button>
      </form>
      <div>
        <div class="text-sm text-slate-300 mb-2">Filter resource packs</div>
        <input class="w-full px-3 py-2 rounded bg-slate-900 border border-slate-800 text-sm focus:outline-none focus:ring-1 focus:ring-emerald-600" type="text" name="q" placeholder="Type to filter…" hx-get="/api/instances/{{ slug }}/resourcepacks/list" hx-target="#resourcepacks-list" hx-trigger="keyup changed delay:300ms" />
      </div>
      <div id="resourcepacks-list" hx-get="/api/instances/{{ slug }}/resourcepacks/list" hx-trigger="load" hx-swap="outerHTML">
        <div class="text-slate-400 text-sm">Loading resource packs…</div>
      </div>
    </div>
  </section>

  <!-- Shader Packs -->
  <section class="border border-slate-800 rounded-lg bg-slate-900/40">
    <div class="px-4 py-3 border-b border-slate-800 flex items-center justify-between">
      <h2 class="text-lg font-semibold">Shader Packs</h2>
      <a href="/instances/{{ slug }}/catalog" class="text-xs px-3 py-1.5 rounded border border-slate-700 hover:bg-slate-800">Browse catalog</a>
    </div>
    <div class="p-4 space-y-4">
      <form hx-post="/api/instances/{{ slug }}/shaderpacks/upload" hx-encoding="multipart/form-data" hx-target="#shaderpacks-list" hx-swap="outerHTML" class="flex items-center gap-2">
        <input type="file" name="file" accept=".zip" class="text-sm file:mr-3 file:px-3 file:py-1.5 file:rounded file:border-0 file:bg-slate-800 file:text-slate-200 hover:file:bg-slate-700" />
        <button type="submit" class="text-sm px-3 py-1.5 rounded border border-slate-700 hover:bg-slate-800">Upload</button>
      </form>
      <div>
        <div class="text-sm text-slate-300 mb-2">Filter shader packs</div>
        <input class="w-full px-3 py-2 rounded bg-slate-900 border border-slate-800 text-sm focus:outline-none focus:ring-1 focus:ring-emerald-600" type="text" name="q" placeholder="Type to filter…" hx-get="/api/instances/{{ slug }}/shaderpacks/list" hx-target="#shaderpacks-list" hx-trigger="keyup changed delay:300ms" />
      </div>
      <div id="shaderpacks-list" hx-get="/api/instances/{{ slug }}/shaderpacks/list" hx-trigger="load" hx-swap="outerHTML">
        <div class="text-slate-400 text-sm">Loading shader packs…</div>
      </div>
    </div>
  </section>
</div>

<!-- Data Packs Row -->
<div class="mt-6 grid grid-cols-1 gap-6">
  <section class="border border-slate-800 rounded-lg bg-slate-900/40">
    <div class="px-4 py-3 border-b border-slate-800 flex items-center justify-between">
      <h2 class="text-lg font-semibold">Data Packs (per World)</h2>
      <a href="/instances/{{ slug }}/catalog" class="text-xs px-3 py-1.5 rounded border border-slate-700 hover:bg-slate-800">Browse catalog</a>
    </div>
    <div class="p-4 space-y-4">
      <!-- World Selector -->
      <div>
        <div class="text-sm text-slate-300 mb-2">World</div>
        <div id="world-select-container" hx-get="/api/instances/{{ slug }}/worlds" hx-trigger="load" hx-swap="outerHTML">
          <select id="world-select" class="w-full px-2 py-1.5 rounded bg-slate-900 border border-slate-800 text-sm"><option>Loading…</option></select>
        </div>
      </div>
      <!-- Upload -->
      <form hx-post="/api/instances/{{ slug }}/datapacks/upload" hx-include="#world-select" hx-encoding="multipart/form-data" hx-target="#datapacks-list" hx-swap="outerHTML" class="flex items-center gap-2">
        <input type="file" name="file" accept=".zip" class="text-sm file:mr-3 file:px-3 file:py-1.5 file:rounded file:border-0 file:bg-slate-800 file:text-slate-200 hover:file:bg-slate-700" />
        <button type="submit" class="text-sm px-3 py-1.5 rounded border border-slate-700 hover:bg-slate-800">Upload</button>
      </form>
      <!-- Filter -->
      <div>
        <div class="text-sm text-slate-300 mb-2">Filter data packs</div>
        <input class="w-full px-3 py-2 rounded bg-slate-900 border border-slate-800 text-sm focus:outline-none focus:ring-1 focus:ring-emerald-600" type="text" name="q" placeholder="Type to filter…" hx-get="/api/instances/{{ slug }}/datapacks/list" hx-include="#world-select" hx-target="#datapacks-list" hx-trigger="keyup changed delay:300ms" />
      </div>
      <!-- List -->
      <div id="datapacks-list" hx-get="/api/instances/{{ slug }}/datapacks/list" hx-include="#world-select" hx-trigger="load from:#world-select changed" hx-swap="outerHTML">
        <div class="text-slate-400 text-sm">Select a world to view datapacks…</div>
      </div>
    </div>
  </section>
</div>
{% endblock %}
