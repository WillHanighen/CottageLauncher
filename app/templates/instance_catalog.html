{% extends "base.html" %}
{% block content %}
<div class="flex items-center justify-between">
  <div>
    <a href="/instances/{{ slug }}" class="text-slate-300 hover:text-white text-sm">← Back to Manage</a>
    <h1 class="text-2xl font-semibold mt-1">Add Content</h1>
    <div class="text-xs text-slate-400">Instance: {{ meta.instance_name or slug }}</div>
  </div>
</div>

<div x-data="{ type: 'mod' }" class="mt-4">
  <!-- Tabs -->
  <div class="inline-flex rounded-md border border-slate-800 overflow-hidden">
    <button @click="type='mod'" hx-get="/api/instances/{{ slug }}/catalog/search" hx-include="#catalog-form" hx-target="#results" class="px-3 py-1.5 text-sm border-r border-slate-800" :class="type==='mod' ? 'bg-slate-800 text-white' : 'bg-slate-900 text-slate-300 hover:bg-slate-800'">Mods</button>
    <button @click="type='resourcepack'" hx-get="/api/instances/{{ slug }}/catalog/search" hx-include="#catalog-form" hx-target="#results" class="px-3 py-1.5 text-sm border-r border-slate-800" :class="type==='resourcepack' ? 'bg-slate-800 text-white' : 'bg-slate-900 text-slate-300 hover:bg-slate-800'">Resource Packs</button>
    <button @click="type='shader'" hx-get="/api/instances/{{ slug }}/catalog/search" hx-include="#catalog-form" hx-target="#results" class="px-3 py-1.5 text-sm border-r border-slate-800" :class="type==='shader' ? 'bg-slate-800 text-white' : 'bg-slate-900 text-slate-300 hover:bg-slate-800'">Shaders</button>
    <button @click="type='datapack'" hx-get="/api/instances/{{ slug }}/catalog/search" hx-include="#catalog-form" hx-target="#results" class="px-3 py-1.5 text-sm" :class="type==='datapack' ? 'bg-slate-800 text-white' : 'bg-slate-900 text-slate-300 hover:bg-slate-800'">Data Packs</button>
  </div>

  <!-- Search + World -->
  <form id="catalog-form" class="mt-4 flex flex-col sm:flex-row gap-3 items-stretch">
    <input type="hidden" name="type" x-model="type" />
    <input id="search-input" name="q" class="flex-1 px-3 py-2 rounded bg-slate-900 border border-slate-800 text-sm focus:outline-none focus:ring-1 focus:ring-emerald-600" type="text" placeholder="Search Modrinth…" />
    <div class="sm:w-64" x-show="type==='datapack'">
      <div class="text-xs text-slate-400 mb-1">World</div>
      <div id="world-select-container" hx-get="/api/instances/{{ slug }}/worlds" hx-trigger="load" hx-swap="outerHTML">
        <select id="world-select" name="world" class="w-full px-2 py-2 rounded bg-slate-900 border border-slate-800 text-sm"><option>Loading…</option></select>
      </div>
    </div>
    <button type="button" class="px-3 py-2 rounded border border-slate-800 hover:bg-slate-800 text-sm"
            hx-get="/api/instances/{{ slug }}/catalog/search" hx-include="#catalog-form" hx-target="#results">Search</button>
  </form>

  <!-- Flash messages -->
  <div id="catalog-flash" class="mt-3 text-sm"></div>

  <!-- Results -->
  <div id="results" class="mt-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3"
       hx-get="/api/instances/{{ slug }}/catalog/search" hx-include="#catalog-form" hx-trigger="load, keyup changed delay:400ms from:#search-input" hx-target="#results">
    <div class="text-slate-400">Searching…</div>
  </div>
</div>
{% endblock %}
